## 包 ##

Node 组织了自身的核心模块，也使得第三方文件模块可以有序地编写和应用。但是在第三方模块中，模块与模块之间仍然是散列在各地的，相互之间不能直接引用。而在模块之外，包和 NPM 则是将模块联系起来的一种机制。

![](http://imgsrc.baidu.com/forum/w%3D580/sign=1f88bb075443fbf2c52ca62b807fca1e/651b6d3d269759eee4b9fec4b5fb43166c22df32.jpg)

包的出现，是在模块的基础上进一步组织 JavaScript 代码。**CommonJS** 的包规范的定义由包结构和包描述文件两部分组成，前者用于组织包中的各种文件，后者用于描述包的相关信息，以供外部读取分析。

### 包结构

一个符合 **CommonJS** 规范的包应该是如下这种结构：

 * 一个 package.json 文件应该存在于包顶级目录下 
 * 二进制文件应该包含在 bin 目录下。 
 * JavaScript 代码应该包含在 lib 目录下。 
 * 文档应该在 doc 目录下。 
 * 单元测试应该在 test 目录下。 

### 包描述文件

包描述文件用于表达非代码相关的信息，它是一个 JSON 格式的文件——package.json，位于包的根目录下。详见 mymath/package.json说明.md。

包规范的定义可以帮助 Node 解决依赖包安装的问题，而 NPM 正是基于该规范进行了实现。


## NPM ##

**NPM** 是随同 **NodeJS** 一起安装的包管理工具，能解决 **NodeJS** 代码部署上的很多问题，常见的使用场景有以下几种：

 * 允许用户从NPM服务器下载别人编写的三方包到本地使用。
 * 允许用户从NPM服务器下载并安装别人编写的命令行程序到本地使用。
 * 允许用户将自己编写的包或命令行程序上传到NPM服务器供别人使用。

可以看到， **NPM** 建立了一个 **NodeJS** 生态圈， **NodeJS** 开发者和用户可以在里边互通有无。借助 **NPM**，可以帮助用户快速安装和管理依赖包。

可以通过 `npm install somemodule` 的方式下载第三方包，它会被放在工程目录下的 **node_modules** 目录中，因此在代码中只需要通过 `require('somemodule')` 的方式加载即可，无需指定三方包路径。该命令默认下载最新版三方包，如果想要下载指定版本的话，可以在包名后边加上 `@<version>`。

考虑到有时用到的三方包比较多， **NPM** 对 **package.json** 的字段做了扩展，允许在其中申明三方包依赖。如下所示：

    {
    	"name": "nodejs_demo",
    	"dependencies": {
       	 	"somemodule": "0.0.1"
    	}
	}


这样处理后，在工程目录下就可以使用 `npm install` 命令批量安装三方包。更重要的是，当以后 **nodejs_demo** 也上传到了NPM服务器，别人下载这个包时， **NPM** 会根据包中申明的三方包依赖自动下载进一步依赖的三方包。